{% extends "layout.html" %}

{% block title %}Manage Resellers - Admin Dashboard - MediaShare{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
{% endblock %}

{% block content %}
<div class="flex items-start justify-center bg-neutral-50 p-4">
    <div class="auth-form-wrapper" style="max-width: 1000px;">
        <!-- Resellers Management Card -->
        <div class="card">
            <div class="card-header text-center">
                <h2 class="mb-1">Reseller Management</h2>
                <p class="text-secondary" style="margin-bottom:0;">Manage reseller accounts and commission rates</p>
            </div>

            <div class="card-body">
                <!-- Action Buttons -->
                <div class="flex justify-end mb-4">
                    <a href="{{ url_for('admin.add_reseller') }}" class="btn">Add Reseller</a>
                </div>

                <!-- Resellers Table -->
                <div class="border border-light rounded-lg p-3 py-1 bg-neutral-50">
                    {% if resellers %}
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-light">
                                    <th class="text-left px-1 py-0">User</th>
                                    <th class="text-left px-1 py-0">Company Name</th>
                                    <th class="text-left px-1 py-0">Website</th>
                                    <th class="text-left px-1 py-0">Commission Rate</th>
                                    <th class="text-center px-1 py-0">Status</th>
                                    <th class="text-center px-1 py-0">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for reseller_data, user in resellers %}
                                <tr class="border-b border-light">
                                    <td class="text-left px-1">{{ user.username }}</td>
                                    <td class="px-1">{{ reseller_data.company_name or 'N/A' }}</td>
                                    <td class="px-1">
                                        {% if reseller_data.website %}
                                            <a href="{{ reseller_data.website }}" target="_blank" class="text-light-blue hover:text-dark-blue">
                                                {{ reseller_data.website }}
                                            </a>
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </td>
                                    <td class="text-left px-1">{{ '{:.1f}%'.format(reseller_data.get_commission_percentage()) }}</td>
                                    <td class="text-center p-1">
                                        {% if reseller_data.is_active %}
                                            <span class="bg-light-blue text-white px-1 py-1 rounded-lg text-xs">Active</span>
                                        {% else %}
                                            <span class="bg-neutral-400 text-white px-1 py-1 rounded-lg text-xs">Inactive</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <div class="flex justify-center gap-2">
                                            <a href="{{ url_for('admin.edit_reseller', reseller_id=reseller_data.id) }}" 
                                                class="btn btn-sm bg-light-blue text-white">Edit</a>
                                            <button class="btn btn-sm bg-purple text-white"
                                                onclick="confirmDelete('{{ reseller_data.id }}', '{{ user.username }}')">Delete</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p class="text-secondary text-center">No resellers found. <a href="{{ url_for('admin.add_reseller') }}" class="text-light-blue">Add your first reseller</a>.</p>
                    {% endif %}
                </div>
            </div>

            <div class="card-footer text-center">
                <p class="text-sm text-secondary">
                    <a href="{{ url_for('admin.dashboard') }}" class="text-light-blue hover:text-dark-blue font-medium">
                        ‚Üê Back to Dashboard
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-neutral-900 bg-opacity-50 hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full">
        <h3 class="text-xl font-semibold text-primary mb-4">Confirm Deletion</h3>
        <p class="text-secondary mb-6">Are you sure you want to delete the reseller account for <span id="deleteResellerName" class="font-semibold"></span>? This action cannot be undone.</p>
        <div class="flex justify-end gap-4">
            <button id="cancelDelete" class="btn  text-primary">Cancel</button>
            <form id="deleteForm" method="POST" action="">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <button type="submit" class="btn bg-purple text-white">Delete</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function confirmDelete(resellerId, resellerName) {
        // Set the reseller name in the confirmation message
        document.getElementById('deleteResellerName').textContent = resellerName;
        
        // Set the form action
        document.getElementById('deleteForm').action = "{{ url_for('admin.delete_reseller', reseller_id=0) }}".replace('0', resellerId);
        
        // Show the modal
        document.getElementById('deleteModal').classList.remove('hidden');
    }
    
    // Cancel button event
    document.getElementById('cancelDelete').addEventListener('click', function() {
        document.getElementById('deleteModal').classList.add('hidden');
    });
    
    // Close modal if clicked outside
    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.add('hidden');
        }
    });
</script>
{% endblock %}